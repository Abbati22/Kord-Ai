const a0_0x1af80b=a0_0x2d8a;(function(_0x5beda4,_0x281012){const _0x1f83da=a0_0x2d8a,_0x519c5f=_0x5beda4();while(!![]){try{const _0x4d4099=parseInt(_0x1f83da(0xdb))/0x1+parseInt(_0x1f83da(0xcc))/0x2+-parseInt(_0x1f83da(0xe6))/0x3*(parseInt(_0x1f83da(0xec))/0x4)+parseInt(_0x1f83da(0x104))/0x5*(-parseInt(_0x1f83da(0xd6))/0x6)+parseInt(_0x1f83da(0xe5))/0x7+parseInt(_0x1f83da(0xf8))/0x8+parseInt(_0x1f83da(0x109))/0x9*(-parseInt(_0x1f83da(0xee))/0xa);if(_0x4d4099===_0x281012)break;else _0x519c5f['push'](_0x519c5f['shift']());}catch(_0x257262){_0x519c5f['push'](_0x519c5f['shift']());}}}(a0_0x3161,0xac018));const a0_0x26c02b=a0_0x444e;(function(_0x294acc,_0x5252c6){const _0x3c852d=a0_0x2d8a,_0x462606=a0_0x444e,_0x5528d9=_0x294acc();while(!![]){try{const _0x4ef656=-parseInt(_0x462606(0x143))/0x1*(parseInt(_0x462606(0x13b))/0x2)+-parseInt(_0x462606(0x145))/0x3+-parseInt(_0x462606(0x154))/0x4*(-parseInt(_0x462606(0x14f))/0x5)+-parseInt(_0x462606(0x13a))/0x6*(parseInt(_0x462606(0x159))/0x7)+-parseInt(_0x462606(0x15a))/0x8+parseInt(_0x462606(0x164))/0x9+parseInt(_0x462606(0x16c))/0xa;if(_0x4ef656===_0x5252c6)break;else _0x5528d9['push'](_0x5528d9[_0x3c852d(0xce)]());}catch(_0x46b6f3){_0x5528d9[_0x3c852d(0xd2)](_0x5528d9[_0x3c852d(0xce)]());}}}(a0_0x10ac,0xa94ff));function a0_0x444e(_0x482e3c,_0xb0bfa5){const _0xe42e7a=a0_0x10ac();return a0_0x444e=function(_0x44552f,_0x39e27a){_0x44552f=_0x44552f-0x132;let _0xe5c1b5=_0xe42e7a[_0x44552f];return _0xe5c1b5;},a0_0x444e(_0x482e3c,_0xb0bfa5);}const sqlite3=require(a0_0x26c02b(0x16b)),{open}=require(a0_0x26c02b(0x13d)),path=require(a0_0x26c02b(0x15d)),chalk=require(a0_0x1af80b(0xef));class DatabaseManager{static async[a0_0x26c02b(0x157)](_0x5d5e2c){const _0x5b3eae=a0_0x1af80b,_0x558b2d=a0_0x26c02b;await _0x5d5e2c[_0x5b3eae(0xdf)](_0x5b3eae(0x10b)),await _0x5d5e2c[_0x558b2d(0x14a)](_0x558b2d(0x155)),await _0x5d5e2c[_0x558b2d(0x14a)](_0x558b2d(0x147)),await _0x5d5e2c[_0x5b3eae(0xdf)](_0x558b2d(0x14d)),await _0x5d5e2c[_0x5b3eae(0xdf)](_0x5b3eae(0xd1));}}function a0_0x3161(){const _0x3d8bd2=['stringify','10038264PPwNIC','queueProcessor','PRAGMA\x20synchronous\x20=\x20NORMAL;','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20messages\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20remoteJid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pushName\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20participant\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageType\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Error\x20getting\x20chat\x20history:','ROLLBACK','sqlite','29972030wnFuFT','1521717zpYXlM','DELETE\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?','64421tBHGzT','processQueue','500810dXQGal','exports','1SZRWJp','395QQImmE','unshift','12255057MfAcVH','Database\x20connection\x20closed\x20successfully','PRAGMA\x20journal_mode\x20=\x20WAL;','SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20AND\x20id\x20=\x20?','now','SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20ORDER\x20BY\x20timestamp\x20DESC\x20LIMIT\x20?','addToQueue','message','1413084DQBrhd','COMMIT','shift','55136dfNUZf','run','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid_timestamp\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid,\x20timestamp\x20DESC)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','push','log','Database','length','6pIYZmn','clearOldMessages','initialize','Error\x20initializing\x20SQLite\x20store:','VACUUM','1276822wsoMEJ','Error\x20loading\x20message:','prepare','logger','exec','2205000opDrBo','Error\x20closing\x20database\x20connection:','parse','changes','writeQueue','1739850kfsbox','565854HsxyjD','SQLite\x20store\x20initialized\x20successfully','green','red','BEGIN\x20TRANSACTION','path','28FPildY','close','10mWUNQO','chalk','get','error','DatabaseManager','bind','writeMessage','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20remoteJid,\x20message,\x20timestamp,\x20pushName,\x20participant)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','join'];a0_0x3161=function(){return _0x3d8bd2;};return a0_0x3161();}function a0_0x2d8a(_0x240425,_0x2ad6b0){const _0x316119=a0_0x3161();return a0_0x2d8a=function(_0x2d8a7b,_0x23720c){_0x2d8a7b=_0x2d8a7b-0xc7;let _0x480d16=_0x316119[_0x2d8a7b];return _0x480d16;},a0_0x2d8a(_0x240425,_0x2ad6b0);}class MessageQueueProcessor{constructor(_0x9a68db){const _0x5e5858=a0_0x1af80b,_0x44fbb6=a0_0x26c02b;this['db']=_0x9a68db,this[_0x5e5858(0xe4)]=[],this[_0x44fbb6(0x13f)]=![];}async[a0_0x1af80b(0x103)](){const _0x5873ab=a0_0x1af80b,_0x531ad3=a0_0x26c02b;if(this['isProcessingQueue']||this[_0x531ad3(0x169)][_0x531ad3(0x132)]===0x0)return;this[_0x531ad3(0x13f)]=!![];try{await this['db'][_0x531ad3(0x151)](_0x531ad3(0x142));const _0x316c4a=await this['db'][_0x531ad3(0x135)](_0x531ad3(0x16a));while(this[_0x531ad3(0x169)][_0x531ad3(0x132)]>0x0){const _0x4f4e94=this[_0x5873ab(0xe4)][_0x531ad3(0x15e)](),{key:_0x170752,messageTimestamp:_0x58d853,pushName:_0x33123a,participant:_0x45632f}=_0x4f4e94;await _0x316c4a[_0x531ad3(0x151)](_0x170752['id'],_0x170752['remoteJid'],JSON[_0x531ad3(0x15b)](_0x4f4e94),_0x58d853,_0x33123a,_0x45632f);}await _0x316c4a[_0x531ad3(0x149)](),await this['db'][_0x531ad3(0x151)](_0x531ad3(0x14b));}catch(_0x4a5094){console[_0x531ad3(0x165)](chalk[_0x5873ab(0xe9)](_0x531ad3(0x153),_0x4a5094)),await this['db'][_0x5873ab(0xd0)](_0x531ad3(0x140)),this[_0x531ad3(0x169)][_0x531ad3(0x144)](...this[_0x531ad3(0x169)]);}finally{this[_0x531ad3(0x13f)]=![],setTimeout(()=>this[_0x531ad3(0x139)](),0x64);}}[a0_0x1af80b(0xca)](_0x3a78ef){const _0x3a8977=a0_0x26c02b;this[_0x3a8977(0x169)][_0x3a8977(0x163)](_0x3a78ef),!this[_0x3a8977(0x13f)]&&this[_0x3a8977(0x139)]();}}class SQLiteMessageStore{constructor(_0x1a29b6){const _0xcd13de=a0_0x1af80b,_0x35bf77=a0_0x26c02b;this[_0x35bf77(0x13c)]=_0x1a29b6,this['db']=null,this[_0xcd13de(0xf9)]=null;}async[a0_0x26c02b(0x166)](){const _0x5a5293=a0_0x1af80b,_0x152d80=a0_0x26c02b;try{this['db']=await open({'filename':path[_0x5a5293(0xf6)](__dirname,'..',_0x152d80(0x138)),'driver':sqlite3[_0x5a5293(0xd4)]}),await DatabaseManager[_0x152d80(0x157)](this['db']),this[_0x152d80(0x167)]=new MessageQueueProcessor(this['db']),console[_0x152d80(0x15c)](chalk[_0x5a5293(0xe8)](_0x152d80(0x150)));}catch(_0x1b67a8){console[_0x152d80(0x165)](chalk[_0x152d80(0x137)](_0x152d80(0x161),_0x1b67a8));throw _0x1b67a8;}}async[a0_0x26c02b(0x156)](_0x3b5162){const _0x24230b=a0_0x26c02b;this['queueProcessor'][_0x24230b(0x16d)](_0x3b5162);}async[a0_0x26c02b(0x133)](_0x4efd3d,_0x2daf8d){const _0x1e2e1d=a0_0x1af80b,_0x48718e=a0_0x26c02b;try{const _0x1e5ee1=await this['db'][_0x48718e(0x13e)](_0x48718e(0x152),[_0x4efd3d,_0x2daf8d]);return _0x1e5ee1?JSON[_0x48718e(0x168)](_0x1e5ee1[_0x48718e(0x158)]):undefined;}catch(_0x1c998e){return console[_0x48718e(0x165)](chalk[_0x48718e(0x137)](_0x1e2e1d(0xdc),_0x1c998e)),undefined;}}async['getChatHistory'](_0x287035,_0x5ba2f4=0x32){const _0x47af98=a0_0x1af80b,_0x15395a=a0_0x26c02b;try{return await this['db'][_0x15395a(0x14c)](_0x47af98(0xc9),[_0x287035,_0x5ba2f4]);}catch(_0x1490f8){return console[_0x47af98(0xf1)](chalk[_0x15395a(0x137)](_0x15395a(0x15f),_0x1490f8)),[];}}async[a0_0x1af80b(0xd7)](_0x812e64=0x1){const _0x392db5=a0_0x26c02b;try{const _0x38b7c9=Math['floor'](Date[_0x392db5(0x160)]()/0x3e8)-_0x812e64*0x18*0x3c*0x3c,_0x375ba0=await this['db'][_0x392db5(0x151)](_0x392db5(0x162),[_0x38b7c9]);_0x375ba0[_0x392db5(0x148)]>0x3e8&&await this['db'][_0x392db5(0x151)](_0x392db5(0x146));}catch(_0x230e7f){console[_0x392db5(0x165)]('Cleanup\x20error');}}async[a0_0x26c02b(0x141)](_0x200428){const _0x1df40b=a0_0x26c02b;_0x200428['on'](_0x1df40b(0x136),async({messages:_0x428793})=>{const _0x2063fe=_0x1df40b;for(const _0x100fde of _0x428793){await this[_0x2063fe(0x156)](_0x100fde);}});}async[a0_0x26c02b(0x16e)](){const _0x5d13d0=a0_0x1af80b,_0x45da45=a0_0x26c02b;try{this['db']&&(await this['db'][_0x45da45(0x16e)](),console[_0x45da45(0x15c)](chalk[_0x45da45(0x134)](_0x5d13d0(0x10a))));}catch(_0x2f6c22){console[_0x5d13d0(0xf1)](chalk[_0x45da45(0x137)](_0x45da45(0x14e),_0x2f6c22));}}}module[a0_0x1af80b(0x105)]=SQLiteMessageStore,module[a0_0x1af80b(0x105)][a0_0x1af80b(0xf2)]=DatabaseManager;function a0_0x10ac(){const _0x44def3=a0_0x1af80b,_0x583f5f=[_0x44def3(0xe1),_0x44def3(0x107),_0x44def3(0xe7),_0x44def3(0xd0),_0x44def3(0xc7),'Error\x20processing\x20write\x20queue:',_0x44def3(0xcf),_0x44def3(0xfa),_0x44def3(0xf4),'createSchema',_0x44def3(0xcb),_0x44def3(0x102),'10862952nUAzVj',_0x44def3(0xf7),_0x44def3(0xd3),_0x44def3(0xeb),'shift',_0x44def3(0xfc),_0x44def3(0xc8),_0x44def3(0xd9),_0x44def3(0x101),_0x44def3(0xd2),_0x44def3(0xe0),'error',_0x44def3(0xd8),_0x44def3(0xf9),_0x44def3(0xe2),_0x44def3(0xe4),_0x44def3(0xf5),'sqlite3',_0x44def3(0xff),_0x44def3(0xca),_0x44def3(0xed),_0x44def3(0xd5),'loadMessage','green',_0x44def3(0xdd),'messages.upsert',_0x44def3(0xe9),'messages.db','processQueue','786DZccnH','1133870yWPrxy',_0x44def3(0xde),_0x44def3(0xfe),_0x44def3(0xf0),'isProcessingQueue',_0x44def3(0xfd),_0x44def3(0xf3),_0x44def3(0xea),_0x44def3(0x106),_0x44def3(0x108),_0x44def3(0x100),_0x44def3(0xda),_0x44def3(0xfb),_0x44def3(0xe3),'finalize',_0x44def3(0xdf),_0x44def3(0xcd),'all','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'];return a0_0x10ac=function(){return _0x583f5f;},a0_0x10ac();}