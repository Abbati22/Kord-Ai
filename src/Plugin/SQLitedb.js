const a0_0x1fdba5=a0_0x4ce5;function a0_0x4ce5(_0x3ebb7e,_0x4b94ac){const _0x5ebb20=a0_0x5ebb();return a0_0x4ce5=function(_0x4ce5a0,_0x4a4d2a){_0x4ce5a0=_0x4ce5a0-0x155;let _0x3844d5=_0x5ebb20[_0x4ce5a0];return _0x3844d5;},a0_0x4ce5(_0x3ebb7e,_0x4b94ac);}function a0_0x5ebb(){const _0x455b4b=['BEGIN\x20TRANSACTION','DatabaseManager','initialize','bind','shift','close','createSchema','red','COMMIT','finalize','stringify','message','clearOldMessages','SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20AND\x20id\x20=\x20?','exports','green','375516hGAxsm','logger','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20messages\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20remoteJid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pushName\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20participant\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageType\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','processQueue','run','queueProcessor','User','error','SELECT\x20pushName\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20messages\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20(remoteJid\x20=\x20?\x20OR\x20participant\x20=\x20?)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20pushName\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x20timestamp\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x201','parse','Error\x20initializing\x20SQLite\x20store:','10622223USISiU','get','Error\x20closing\x20database\x20connection:','DELETE\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?','prepare','pushName','1363869JmvTyZ','ROLLBACK','writeMessage','Database\x20connection\x20closed\x20successfully','4183850oXbFGt','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid_timestamp\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid,\x20timestamp\x20DESC)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','SQLite\x20store\x20initialized\x20successfully','8siLklq','3227865QOgrGM','4LdlBbS','floor','@s.whatsapp.net','getPushName','join','923466YOKAiO','addToQueue','length','1178265MHImge','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','sqlite3','all','messages.db','sqlite','Cleanup\x20error','exec','path','writeQueue','PRAGMA\x20synchronous\x20=\x20NORMAL;','PRAGMA\x20journal_mode\x20=\x20WAL;','isProcessingQueue','log','42tggOmN'];a0_0x5ebb=function(){return _0x455b4b;};return a0_0x5ebb();}(function(_0x2f25dd,_0x373654){const _0x45cdb8=a0_0x4ce5,_0x30a779=_0x2f25dd();while(!![]){try{const _0x29d941=parseInt(_0x45cdb8(0x17b))/0x1+parseInt(_0x45cdb8(0x173))/0x2*(-parseInt(_0x45cdb8(0x16a))/0x3)+-parseInt(_0x45cdb8(0x159))/0x4+parseInt(_0x45cdb8(0x172))/0x5+-parseInt(_0x45cdb8(0x178))/0x6*(parseInt(_0x45cdb8(0x189))/0x7)+parseInt(_0x45cdb8(0x171))/0x8*(parseInt(_0x45cdb8(0x164))/0x9)+-parseInt(_0x45cdb8(0x16e))/0xa;if(_0x29d941===_0x373654)break;else _0x30a779['push'](_0x30a779['shift']());}catch(_0x56cf95){_0x30a779['push'](_0x30a779['shift']());}}}(a0_0x5ebb,0xa0ea5));const sqlite3=require(a0_0x1fdba5(0x17d)),{open}=require(a0_0x1fdba5(0x180)),path=require(a0_0x1fdba5(0x183)),chalk=require('chalk');class DatabaseManager{static async[a0_0x1fdba5(0x190)](_0x4c9267){const _0x29d5d5=a0_0x1fdba5;await _0x4c9267[_0x29d5d5(0x182)](_0x29d5d5(0x186)),await _0x4c9267[_0x29d5d5(0x182)](_0x29d5d5(0x185)),await _0x4c9267[_0x29d5d5(0x182)](_0x29d5d5(0x15b)),await _0x4c9267[_0x29d5d5(0x182)](_0x29d5d5(0x17c)),await _0x4c9267[_0x29d5d5(0x182)](_0x29d5d5(0x16f));}}class MessageQueueProcessor{constructor(_0x15cbf2){const _0x19e925=a0_0x1fdba5;this['db']=_0x15cbf2,this[_0x19e925(0x184)]=[],this['isProcessingQueue']=![];}async[a0_0x1fdba5(0x15c)](){const _0x5af033=a0_0x1fdba5;if(this['isProcessingQueue']||this['writeQueue'][_0x5af033(0x17a)]===0x0)return;this[_0x5af033(0x187)]=!![];try{await this['db'][_0x5af033(0x15d)](_0x5af033(0x18a));const _0x1c16cc=await this['db'][_0x5af033(0x168)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20remoteJid,\x20message,\x20timestamp,\x20pushName,\x20participant)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)');while(this[_0x5af033(0x184)][_0x5af033(0x17a)]>0x0){const _0x3f8957=this['writeQueue'][_0x5af033(0x18e)](),{key:_0x250580,messageTimestamp:_0x118b95,pushName:_0x5c3aff,participant:_0x1ffaae}=_0x3f8957;await _0x1c16cc[_0x5af033(0x15d)](_0x250580['id'],_0x250580['remoteJid'],JSON[_0x5af033(0x194)](_0x3f8957),_0x118b95,_0x5c3aff,_0x1ffaae);}await _0x1c16cc[_0x5af033(0x193)](),await this['db'][_0x5af033(0x15d)](_0x5af033(0x192));}catch(_0x356f44){console[_0x5af033(0x160)](chalk[_0x5af033(0x191)]('Error\x20processing\x20write\x20queue:',_0x356f44)),await this['db'][_0x5af033(0x15d)](_0x5af033(0x16b)),this[_0x5af033(0x184)]['unshift'](...this[_0x5af033(0x184)]);}finally{this['isProcessingQueue']=![],setTimeout(()=>this[_0x5af033(0x15c)](),0x64);}}[a0_0x1fdba5(0x179)](_0x2db4ae){const _0x178804=a0_0x1fdba5;this['writeQueue']['push'](_0x2db4ae),!this[_0x178804(0x187)]&&this[_0x178804(0x15c)]();}}class SQLiteMessageStore{constructor(_0x558e9c){const _0x541182=a0_0x1fdba5;this[_0x541182(0x15a)]=_0x558e9c,this['db']=null,this[_0x541182(0x15e)]=null;}async[a0_0x1fdba5(0x18c)](){const _0x2531b8=a0_0x1fdba5;try{this['db']=await open({'filename':path[_0x2531b8(0x177)](__dirname,'..',_0x2531b8(0x17f)),'driver':sqlite3['Database']}),await DatabaseManager[_0x2531b8(0x190)](this['db']),this[_0x2531b8(0x15e)]=new MessageQueueProcessor(this['db']),console[_0x2531b8(0x188)](chalk[_0x2531b8(0x158)](_0x2531b8(0x170)));}catch(_0xd29d49){console[_0x2531b8(0x160)](chalk[_0x2531b8(0x191)](_0x2531b8(0x163),_0xd29d49));throw _0xd29d49;}}async[a0_0x1fdba5(0x16c)](_0x3f4982){const _0x7743e8=a0_0x1fdba5;this[_0x7743e8(0x15e)][_0x7743e8(0x179)](_0x3f4982);}async['loadMessage'](_0x4200f5,_0x2de0a7){const _0x506f0a=a0_0x1fdba5;try{const _0x34f131=await this['db']['get'](_0x506f0a(0x156),[_0x4200f5,_0x2de0a7]);return _0x34f131?JSON[_0x506f0a(0x162)](_0x34f131[_0x506f0a(0x195)]):undefined;}catch(_0x301eb3){return console[_0x506f0a(0x160)](chalk['red']('Error\x20loading\x20message:',_0x301eb3)),undefined;}}async[a0_0x1fdba5(0x176)](_0x1ab0bd){const _0xa4ea33=a0_0x1fdba5;try{if(!_0x1ab0bd)return _0xa4ea33(0x15f);const _0x19fad8=_0x1ab0bd['split']('@')[0x0]+_0xa4ea33(0x175),_0x13b535=await this['db'][_0xa4ea33(0x165)](_0xa4ea33(0x161),[_0x19fad8,_0x19fad8]);return _0x13b535?.[_0xa4ea33(0x169)]||_0xa4ea33(0x15f);}catch(_0x47e444){return console[_0xa4ea33(0x160)](chalk[_0xa4ea33(0x191)]('Error\x20getting\x20pushName:',_0x47e444)),_0xa4ea33(0x15f);}}async['getChatHistory'](_0x3f6d8d,_0x34fc2b=0x32){const _0x4e53a6=a0_0x1fdba5;try{return await this['db'][_0x4e53a6(0x17e)]('SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20ORDER\x20BY\x20timestamp\x20DESC\x20LIMIT\x20?',[_0x3f6d8d,_0x34fc2b]);}catch(_0x1f878b){return console[_0x4e53a6(0x160)](chalk['red']('Error\x20getting\x20chat\x20history:',_0x1f878b)),[];}}async[a0_0x1fdba5(0x155)](_0x1da00d=0x1){const _0x12bb7c=a0_0x1fdba5;try{const _0x3b618b=Math[_0x12bb7c(0x174)](Date['now']()/0x3e8)-_0x1da00d*0x18*0x3c*0x3c,_0x579d43=await this['db'][_0x12bb7c(0x15d)](_0x12bb7c(0x167),[_0x3b618b]);_0x579d43['changes']>0x3e8&&await this['db']['run']('VACUUM');}catch(_0x8ce7bd){console[_0x12bb7c(0x160)](_0x12bb7c(0x181));}}async[a0_0x1fdba5(0x18d)](_0x5d3d22){_0x5d3d22['on']('messages.upsert',async({messages:_0x10057b})=>{const _0x2d7f6d=a0_0x4ce5;for(const _0x3fe2a1 of _0x10057b){await this[_0x2d7f6d(0x16c)](_0x3fe2a1);}});}async[a0_0x1fdba5(0x18f)](){const _0x2577d=a0_0x1fdba5;try{this['db']&&(await this['db'][_0x2577d(0x18f)](),console['log'](chalk[_0x2577d(0x158)](_0x2577d(0x16d))));}catch(_0x146b7c){console[_0x2577d(0x160)](chalk[_0x2577d(0x191)](_0x2577d(0x166),_0x146b7c));}}}module[a0_0x1fdba5(0x157)]=SQLiteMessageStore,module[a0_0x1fdba5(0x157)][a0_0x1fdba5(0x18b)]=DatabaseManager;